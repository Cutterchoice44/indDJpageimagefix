<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cutters Choice Radio — DJ Selects</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
  :root{ --teal:#5A8785 }
  body{ margin:0; background:#0a0a0a; color:#e8f6f5; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif }
  header h1{ margin:.6rem 0 0; text-align:center; font-family:'Bebas Neue',sans-serif; font-size:3.2rem }
  header p{ margin:0 0 .6rem; text-align:center; color:#a7d0cc }
  .bar{ height:2px; background:var(--teal) }
  .hero{ display:grid; grid-template-columns: 1fr minmax(360px,560px) minmax(380px,1fr) !important;
         gap:.6rem; align-items:end; padding:.6rem .75rem .35rem; border:2px solid var(--teal); border-left:0;border-right:0 }
  .strap{ font-family:'Bebas Neue',sans-serif; letter-spacing:.2px }
  .big{ font-family:'Bebas Neue',sans-serif; font-size:3.3rem; line-height:1 }
  #djName{ color:var(--teal) }
  .art img{ width:100%; height:auto; border:2px solid var(--teal); border-radius:4px; background:#000; min-height:130px }
  .bio{ background:#0b0b0b; border:2px solid var(--teal); border-radius:6px; padding:.55rem .65rem; min-height:100% }
  .profile{ display:none; font-size:.8rem; border:1px solid #335d5b; padding:.2rem .4rem; border-radius:4px; background:#0b0b0b; color:#dff; text-decoration:none; margin-left:.6rem }
  .next{ margin:.35rem .6rem .6rem; background:#0b0b0b; border:2px solid var(--teal); border-radius:6px; padding:.45rem .6rem; display:flex; gap:1rem; align-items:center }
  .next .label{ font-family:'Bebas Neue',sans-serif }
  .next .when{ font-family:'Bebas Neue',sans-serif; color:var(--teal); font-size:1.3rem }
  @media (max-width:960px){ .hero{ grid-template-columns:1fr minmax(220px,36vw) 1fr !important } .big{ font-size:2.6rem } }
</style>
</head>
<body>
  <header>
    <h1>CUTTERS CHOICE RADIO</h1>
    <p>The home of relentless flavas and significant bangers!</p>
  </header>
  <div class="bar"></div>

  <section class="hero" id="hero">
    <div>
      <div class="strap">EACH WEEK IN A NON SPECIFIC ORDER A DIFFERENT CUTTERS DJ SELECTS THEIR 5 TRACKS OF THE WEEK</div>
      <div class="big">
        THIS WEEKS CUTTERS DJ SELECTOR : <span id="djName">DJ NAME</span>
        <a id="djLink" class="profile" target="_blank" rel="noopener">DJ profile</a>
      </div>
    </div>
    <div class="art">
      <img id="djImg" src="/images/default-dj.png"
           onerror="this.onerror=null;this.src='https://dummyimage.com/560x560/000/5a8785.png&text=DJ';" alt="">
    </div>
    <div class="bio" id="djBio">Loading selector description…</div>
  </section>

  <section class="next">
    <div class="label">NEXT SCHEDULED SHOW</div>
    <div class="when" id="nextWhen">Loading…</div>
  </section>

<script>
const PROXY = 'rc-proxy.php';
const STATION_ID = 'cutters-choice-radio';
const SELECTOR_SLUG = 'selector';

const djName  = document.getElementById('djName');
const djImg   = document.getElementById('djImg');
const djBio   = document.getElementById('djBio');
const djLink  = document.getElementById('djLink');
const nextWhen= document.getElementById('nextWhen');

function fmt(iso){
  try{
    return new Date(iso).toLocaleString(undefined,{weekday:'short',day:'numeric',month:'short',hour:'2-digit',minute:'2-digit',hour12:false,timeZoneName:'short'});
  }catch{ return ''; }
}

(async function init(){
  try{
    const url = `${PROXY}?fn=selector&stationId=${encodeURIComponent(STATION_ID)}&slug=${encodeURIComponent(SELECTOR_SLUG)}`;
    const r   = await fetch(url, {cache:'no-store'});
    const txt = await r.text();              // robust in case server sets wrong header
    let data; try{ data = JSON.parse(txt); } // ensure JSON
    catch(e){ console.error('Proxy returned non-JSON:', txt); throw e; }
    if (!data.ok) throw new Error(data.error||'proxy error');

    djName.textContent = data.displayName || data.name || 'DJ';
    if (data.image) djImg.src = data.image;
    djBio.textContent = (data.description||'').trim() || '—';
    if (data.shareUrl){ djLink.href = data.shareUrl; djLink.style.display='inline-block'; }
    if (data.nextShow && data.nextShow.start) nextWhen.textContent = fmt(data.nextShow.start);
    else nextWhen.textContent = 'No upcoming show found';
  }catch(err){
    console.error(err);
    djBio.textContent   = 'Could not load SELECTOR profile.';
    nextWhen.textContent= 'Unable to load schedule';
  }
})();
</script>
</body>
</html>
