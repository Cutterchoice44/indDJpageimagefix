<?php
// dj-selects-config.php â€” tiny store for DJ Selects settings (tracks, optional overrides)
declare(strict_types=1);
header('Access-Control-Allow-Origin: *');
header('Content-Type: application/json; charset=utf-8');

$action = $_GET['action'] ?? 'load';
$file   = __DIR__ . '/dj-selects-config.json';

// Load
if ($action === 'load') {
  if (is_file($file)) { $raw = file_get_contents($file); echo $raw !== false ? $raw : '{}'; }
  else { echo '{}'; }
  exit;
}

// Save (optional; if you wire an admin UI later)
if ($action === 'save') {
  $input = json_decode(file_get_contents('php://input') ?: '{}', true);
  if (!is_array($input)) $input = [];
  $data  = $input['data'] ?? [];
  if (!is_array($data)) $data = [];

  // Only allow expected keys
  $allow = ['tracks','djName','profileImage','stationId','apiKey','contributorId','contributorSlug','contributorKind'];
  $clean = [];
  foreach ($allow as $k) { if (isset($data[$k])) $clean[$k] = $data[$k]; }

  $tmp = $file.'.tmp';
  file_put_contents($tmp, json_encode($clean, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES));
  rename($tmp, $file);
  echo json_encode(['ok'=>true]); exit;
}

echo '{}';
